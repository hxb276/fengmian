{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Format str</title>
    <style>
        body {
            background-image: linear-gradient(135deg, #FAD7A1 10%, #E96D71 100%);
        }
        .container {
            text-align: center;
        }
        .btn {
            text-align: center;
            font-size: 1.4rem;
            color: #fff;
        }
        .btn input {
            width: 5rem;  
            padding:.5rem;  
            margin: 0 10px;
            background-color: #428bca;  
            border-color: #357ebd;  
            color: #fff;  
            -moz-border-radius: 10px;  
            -webkit-border-radius: 10px;  
            border-radius: 10px; /* future proofing */  
            -khtml-border-radius: 10px; /* for old Konqueror browsers */  
            text-align: center;  
            vertical-align: middle;  
            border: 1px solid transparent;
            font-weight: 800;
            font-size: 1rem;


        }
        .downtips {
            margin: .5rem 0;
            background-color: rgba(2, 25, 25, .3);
            color: #fff;
            padding: .5rem 0;
        }
        .downtips span {
            color: rgb(137, 252, 7);
            font-weight: 900;
        }
        .tips {
            color: #f00;
            text-align: center;
        }
        .text textarea {
            width: 80%;
            min-height: 25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="btn">
            <form action="" method="post">
            {% csrf_token %}
            <input type="button" value="整理" id="format">
            <input type="button" value="复制" id="copy">
            <input type="button" value="导出txt" id="txt">
            <a onfocus="this.blur();" download="xuliehao.txt" id="createInvote" class=" hide" ></a>
            </form>
        </div>
        <p class="downtips"><span>导出功能：</span>已优化，可直接导出，支持1000+数据</p>
        <p class="tips">请将序列号粘贴在下方...</p>
        <div class="text">
            <textarea id="texta"></textarea>
        </div>
    </div>
    <script src="{% static 'fengmian/js/jquery-3.3.1.min.js' %}"></script>
    <script>
        $(function() {
            let $copy = $('#copy'),
                $format = $('#format'),
                $txt = $('#txt'),
                $texta = $('#texta'),
                $tips = $('p.tips');

            function copy() {
                $texta.select();
                document.execCommand("Copy");
                $tips.text('复制成功')
            };
            function getNewStr() {

                let value = $texta.val();
                let valueArr = '';
                let newStr = ''
                if (value.indexOf(':') != -1 && value.indexOf('\n') != -1) {
                    valueArr = value.split(':')
                }else if (value.indexOf('\n') != -1) {
                    valueArr = value.split('\n')
                }else {
                    valueArr = ''
                }
                for (i in valueArr) {
                    if (valueArr[i] != '') {
                        newStr += valueArr[i].match(/[A-z0-9]+/)[0] + '\r\n'
                    }
                }
                return newStr
            }
            $format.click(()=> {
                let newStr = getNewStr();
                $texta.val(newStr);
                $tips.text('格式化成功，请复制');
            })
            $txt.click(function() {
                let newStr = getNewStr()
                var isIE = (navigator.userAgent.indexOf('MSIE') >= 0);
                if (isIE) {
                    var strHTML = newStr;
                    var winSave = window.open();
                    winSave.document.open("text","utf-8");
                    winSave.document.write(strHTML);
                    winSave.document.execCommand("SaveAs",true,"xuliehao.txt");
                    winSave.close();
                } else {
                    var elHtml = newStr;
                    var mimeType =  'text/plain';
                    $('#createInvote').attr('href', 'data:' + mimeType  +  ';charset=utf-8,' + encodeURIComponent(elHtml));
                    document.getElementById('createInvote').click();
                }
            })

            $copy.click(()=>{copy()});


        })
    </script>
</body>
</html>